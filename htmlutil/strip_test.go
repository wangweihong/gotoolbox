package htmlutil_test

import (
	"testing"

	. "github.com/smartystreets/goconvey/convey"
	html "github.com/wangweihong/gotoolbox/htmlutil"
)

func TestTrimHtml(t *testing.T) {
	Convey("", t, func() {
		expect := "服务器硬件\n硬件\n通用\n通用\n问题描述\n部署前规划网桥启动在千兆网卡上，\n使用万兆网络访问环境。\n需求手动切换万兆管理网卡，并清除数据盘lv残留数据。\n警示信息\n有效排查步骤\n进入底层系统，使用ip a 查看网卡启动情况，下图所示ovs网桥连接物理网卡状态为down，说明未启用。\n需要手动修改网桥。\nlsblk可以看到大量lv逻辑卷组。\n根因\n无\n解决方案\n1、手动进入底层系统手动修改\n2、使用命令更换网桥下的物理网卡\novs-vsctl add-bond-iface managerbreth ens35f0\u00a0 type=system\novs-vsctl del-bond-iface managerbreth ens49f3\nnmcli connection delete ens49f3\nnmcli device reapply managerbr\n3、更换网卡后，手动删除lv、vg、后制作文件系统\nlvremove lv名\nvgremove vg名\nfor i in {b,c,d,e,f,g} ; do mkfs.xfs -f /dev/sd$i;done\n操作影响范围\n无"
		origin := "<p><span style=\"color: rgb(255,0,0);\"><u><strong>服务器硬件</strong></u></span></p><p><span style=\"color: rgb(255,0,0);\"><u><strong>硬件</strong></u></span></p><p><span style=\"color: rgb(255,0,0);\"><u><strong>通用</strong></u></span></p><p><span style=\"color: rgb(255,0,0);\"><u><strong>通用</strong></u></span></p><h2 id=\"部署后管理网络不通-问题描述\"><strong>问题描述</strong></h2><p>部署前规划网桥启动在千兆网卡上，</p><p>使用万兆网络访问环境。</p><p>需求手动切换万兆管理网卡，并清除数据盘lv残留数据。</p><h2 id=\"部署后管理网络不通（内部）-警示信息\"><strong>警示信息</strong></h2><p><br/></p><h2 id=\"id-超融合环境部署后管理网络不通（内部）-有效排查步骤\"><strong>有效排查步骤</strong></h2><p>进入底层系统，使用ip a 查看网卡启动情况，下图所示ovs网桥连接物理网卡状态为down，说明未启用。</p><p><span class=\"confluence-embedded-file-wrapper confluence-embedded-manual-size\"><img class=\"confluence-embedded-image\" draggable=\"false\" height=\"80\" src=\"/download/attachments/18088152/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16994241816893.png?version=1&modificationDate=1700212625881&api=v2\" data-image-src=\"/download/attachments/18088152/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16994241816893.png?version=1&modificationDate=1700212625881&api=v2\" data-unresolved-comment-count=\"0\" data-linked-resource-id=\"20873741\" data-linked-resource-version=\"1\" data-linked-resource-type=\"attachment\" data-linked-resource-default-alias=\"企业微信截图_16994241816893.png\" data-base-url=\"https://cloud.mixware.cn:58082\" data-linked-resource-content-type=\"image/png\" data-linked-resource-container-id=\"18088152\" data-linked-resource-container-version=\"5\" alt=\"\"></span></p><p>需要手动修改网桥。</p><p>lsblk可以看到大量lv逻辑卷组。</p><p><span class=\"confluence-embedded-file-wrapper confluence-embedded-manual-size\"><img class=\"confluence-embedded-image\" draggable=\"false\" height=\"250\" src=\"/download/attachments/18088152/image-2023-10-31-09-54-38-231.png?version=1&modificationDate=1698724928779&api=v2\" data-image-src=\"/download/attachments/18088152/image-2023-10-31-09-54-38-231.png?version=1&modificationDate=1698724928779&api=v2\" data-unresolved-comment-count=\"0\" data-linked-resource-id=\"18088153\" data-linked-resource-version=\"1\" data-linked-resource-type=\"attachment\" data-linked-resource-default-alias=\"image-2023-10-31-09-54-38-231.png\" data-base-url=\"https://cloud.mixware.cn:58082\" data-linked-resource-content-type=\"image/png\" data-linked-resource-container-id=\"18088152\" data-linked-resource-container-version=\"5\" alt=\"\"></span></p><h2 id=\"id-超融合环境部署后管理网络不通（内部）-根因\"><strong>根因</strong></h2><p>无</p><h2 id=\"id-超融合环境部署后管理网络不通（内部）-解决方案\"><strong>解决方案</strong></h2><p>1、手动进入底层系统手动修改</p><p>2、使用命令更换网桥下的物理网卡</p><p>ovs-vsctl add-bond-iface managerbreth ens35f0  type=system<br/>ovs-vsctl del-bond-iface managerbreth ens49f3<br/>nmcli connection delete ens49f3<br/>nmcli device reapply managerbr</p><p>3、更换网卡后，手动删除lv、vg、后制作文件系统</p><p>lvremove lv名</p><p>vgremove vg名</p><p>for i in {b,c,d,e,f,g} ; do mkfs.xfs -f /dev/sd$i;done</p><h2 id=\"id-超融合环境部署后管理网络不通（内部）-操作影响范围\"><strong>操作影响范围</strong></h2><p>无</p>"
		//fmt.Printf("%q\n", strip.TrimHtml(origin))
		So(html.TrimHtml(origin), ShouldEqual, expect)
	})
}
